ARG SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI
ARG SERVICO_EXTERNO_CONTAS_BASE_URI
ARG SERVICO_EXTERNO_CONTAS_CARTOES_URN
ARG SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN

FROM maven:3-openjdk-11 AS builder
ARG SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI
ARG SERVICO_EXTERNO_CONTAS_BASE_URI
ARG SERVICO_EXTERNO_CONTAS_CARTOES_URN
ARG SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN
ENV DATABASE_PLATFORM h2
ENV DATABASE_DRIVER org.h2.Driver
ENV DATABASE_URL jdbc:h2:mem:testdb
ENV DATABASE_USER root
ENV DATABASE_PASSWORD 12345
ENV SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI $SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI
ENV SERVICO_EXTERNO_CONTAS_BASE_URI $SERVICO_EXTERNO_CONTAS_BASE_URI
ENV SERVICO_EXTERNO_CONTAS_CARTOES_URN $SERVICO_EXTERNO_CONTAS_CARTOES_URN
ENV SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN $SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN
COPY ./src/ app/src/
COPY ./pom.xml app/
RUN /usr/bin/mvn -f app/ clean package

FROM openjdk:11
ARG SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI
ARG SERVICO_EXTERNO_CONTAS_BASE_URI
ARG SERVICO_EXTERNO_CONTAS_CARTOES_URN
ARG SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN
ENV SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI $SERVICO_EXTERNO_ANALISE_SOLICITACAO_URI
ENV SERVICO_EXTERNO_CONTAS_BASE_URI $SERVICO_EXTERNO_CONTAS_BASE_URI
ENV SERVICO_EXTERNO_CONTAS_CARTOES_URN $SERVICO_EXTERNO_CONTAS_CARTOES_URN
ENV SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN $SERVICO_EXTERNO_CONTAS_CARTOES_BLOQUEIOS_URN
COPY --from=builder app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT java -jar app.jar